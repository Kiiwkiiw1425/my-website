<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายการอัปเดตโปรแกรม</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">รายการอัปเดตโปรแกรม</h1>

    <!-- Filters -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">ค้นหา</label>
        <input id="searchInput" type="text" placeholder="ค้นหาคำในหัวข้อหรือรายละเอียด" class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="applyFilters()">
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">วันที่เริ่มต้น</label>
        <input id="startDate" type="date" class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">วันที่สิ้นสุด</label>
        <input id="endDate" type="date" class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">เลือกเดือน</label>
        <select id="monthFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
          <option value="">ทุกเดือน</option>
          <option value="01">มกราคม</option>
          <option value="02">กุมภาพันธ์</option>
          <option value="03">มีนาคม</option>
          <option value="04">เมษายน</option>
          <option value="05">พฤษภาคม</option>
          <option value="06">มิถุนายน</option>
          <option value="07">กรกฎาคม</option>
          <option value="08">สิงหาคม</option>
          <option value="09">กันยายน</option>
          <option value="10">ตุลาคม</option>
          <option value="11">พฤศจิกายน</option>
          <option value="12">ธันวาคม</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">หมวดหมู่</label>
        <select id="categoryFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
          <option value="">ทุกหมวดหมู่</option>
          <option value="ระบบ">ระบบ</option>
          <option value="คู่มือ">คู่มือ</option>
          <option value="อื่นๆ">อื่นๆ</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">สถานะอัปเดต</label>
        <select id="updateStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyUpdateStatus()">
          <option value="">ทั้งหมด</option>
          <option value="latest">อัปเดตล่าสุด (7 วัน)</option>
          <option value="hasUpdate">มีอัปเดต</option>
          <option value="noUpdate">ไม่มีอัปเดต</option>
        </select>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mb-4 flex flex-wrap items-center gap-4">
      <button onclick="resetFilters()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 transition">ล้างทั้งหมด</button>
      <span id="updateCount" class="text-blue-600 font-medium"></span>
    </div>

    <!-- Update Posts -->
    <div id="updatesContainer" class="space-y-4">
      <!-- รายการอัปเดตจะแสดงตรงนี้ -->
    </div>
  </div>

  <script>
    const allPosts = [
      { date: "14 มี.ค. 2567", title: "เพิ่มเมนูใหม่", detail: "มีการเพิ่มเมนูระบบ", month: "03", category: "ระบบ" },
      { date: "10 มี.ค. 2567", title: "อัปเดตเวอร์ชัน", detail: "ไม่มีอัปเดตในช่วงนี้", month: "03", category: "คู่มือ" },
      { date: "01 มี.ค. 2567", title: "แก้ไขบั๊ก", detail: "แก้ไขปัญหาการแสดงผล", month: "03", category: "ระบบ" },
      { date: "01 ก.พ. 2567", title: "ประกาศทั่วไป", detail: "ไม่มีอัปเดตเพิ่มเติม", month: "02", category: "อื่นๆ" },
      { date: "28 ก.พ. 2567", title: "ปรับปรุงระบบ", detail: "มีการปรับปรุงระบบบางส่วน", month: "02", category: "ระบบ" }
    ];

    function parseThaiDate(thaiDate) {
      const months = {
        'ม.ค.': '01', 'ก.พ.': '02', 'มี.ค.': '03', 'เม.ย.': '04',
        'พ.ค.': '05', 'มิ.ย.': '06', 'ก.ค.': '07', 'ส.ค.': '08',
        'ก.ย.': '09', 'ต.ค.': '10', 'พ.ย.': '11', 'ธ.ค.': '12'
      };
      const parts = thaiDate.split(" ");
      const day = parts[0];
      const month = months[parts[1]];
      const year = parseInt(parts[2]) - 543;
      return new Date(`${year}-${month}-${day}`);
    }

    function renderPosts(posts) {
      const container = document.getElementById("updatesContainer");
      container.innerHTML = "";

      if (posts.length === 0) {
        container.innerHTML = `<div class="text-red-500">ไม่พบรายการ</div>`;
        return;
      }

      posts.forEach(post => {
        const postEl = document.createElement("div");
        postEl.className = "bg-white p-4 rounded-lg shadow";
        postEl.innerHTML = `
          <div class="text-gray-500 text-sm mb-1">${post.date}</div>
          <h2 class="text-lg font-semibold">${post.title}</h2>
          <p class="text-gray-700 mt-1">${post.detail}</p>
        `;
        container.appendChild(postEl);
      });
    }

    function applyFilters() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const start = document.getElementById("startDate").value;
      const end = document.getElementById("endDate").value;
      const monthVal = document.getElementById("monthFilter").value;
      const catVal = document.getElementById("categoryFilter").value;
      const updateStatus = document.getElementById("updateStatus").value;

      const today = new Date();
      const latestThreshold = new Date();
      latestThreshold.setDate(today.getDate() - 7);

      const filtered = allPosts.filter(post => {
        if (!post.detail) return false;

        const postDate = parseThaiDate(post.date);
        const content = `${post.title} ${post.detail}`.toLowerCase();

        let match = true;

        if (search && !content.includes(search)) match = false;
        if (start && postDate < new Date(start)) match = false;
        if (end && postDate > new Date(end)) match = false;
        if (monthVal && post.month !== monthVal) match = false;
        if (catVal && post.category !== catVal) match = false;

        if (updateStatus === "latest" && (postDate < latestThreshold || postDate > today || post.detail.includes("ไม่มีอัปเดต"))) {
          match = false;
        } else if (updateStatus === "hasUpdate" && post.detail.includes("ไม่มีอัปเดต")) {
          match = false;
        } else if (updateStatus === "noUpdate" && !post.detail.includes("ไม่มีอัปเดต")) {
          match = false;
        }

        return match;
      });

      renderPosts(filtered);
      document.getElementById("updateCount").innerText = `พบทั้งหมด ${filtered.length} รายการ`;
    }

    function resetFilters() {
      document.getElementById("searchInput").value = "";
      document.getElementById("startDate").value = "";
      document.getElementById("endDate").value = "";
      document.getElementById("monthFilter").value = "";
      document.getElementById("categoryFilter").value = "";
      document.getElementById("updateStatus").value = "";
      document.getElementById("updateCount").innerText = "";
      applyFilters();
    }

    function applyUpdateStatus() {
      applyFilters();
    }

    // โหลดข้อมูลเริ่มต้น
    window.onload = () => {
      renderPosts(allPosts);
    };
  </script>
</body>
</html>
