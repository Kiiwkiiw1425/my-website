<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-4">
  <div class="max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold text-blue-700 mb-6">üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>

    <!-- Search & Controls -->
    <div class="flex flex-wrap gap-4 mb-6 items-end">
      <div class="flex-grow">
        <label class="block text-sm font-medium mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
        <input id="searchInput" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500" />
      </div>
      <button id="searchBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      <button id="clearBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">‡∏•‡πâ‡∏≤‡∏á</button>
    </div>

    <!-- Filters -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
      <div>
        <label class="block mb-1 font-medium">‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</label>
        <select id="ministryFilter" class="w-full border rounded-lg px-3 py-2">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        </select>
      </div>
      <div>
        <label class="block mb-1 font-medium">‡∏Å‡∏£‡∏°/‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</label>
        <select id="departmentFilter" class="w-full border rounded-lg px-3 py-2">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        </select>
      </div>
      <div>
        <label class="block mb-1 font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
        <select id="statusFilter" class="w-full border rounded-lg px-3 py-2">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à</option>
          <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÇ‡∏≠‡∏ô">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÇ‡∏≠‡∏ô</option>
          <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô</option>
        </select>
      </div>
      <div>
        <label class="block mb-1 font-medium">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</label>
        <select id="locationFilter" class="w-full border rounded-lg px-3 py-2">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="OWNER">OWNER</option>
          <option value="OCSC">OCSC</option>
        </select>
      </div>
      <div>
        <label class="block mb-1 font-medium">‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</label>
        <select id="setupFilter" class="w-full border rounded-lg px-3 py-2">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="production">Production</option>
          <option value="test">Test</option>
        </select>
      </div>
    </div>

    <!-- Results -->
    <div id="monitorList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    <p id="noDataMsg" class="text-center text-red-600 mt-8 hidden">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const sheetURL = "https://docs.google.com/spreadsheets/d/1xRqnFHRWL3l_-6-LNJ_LM5Bejiv0aV5JwcV9PtzC-Nk/gviz/tq?sheet=from_Excel_list_covert&tqx=out:json";
    let allData = [];

    const filterData = () => {
      const search = $("searchInput").value.trim().toLowerCase();
      const ministry = $("ministryFilter").value.toLowerCase();
      const department = $("departmentFilter").value.toLowerCase();
      const status = $("statusFilter").value.toLowerCase();
      const location = $("locationFilter").value.toLowerCase();
      const setup = $("setupFilter").value.toLowerCase();

      const filtered = allData.filter(item => {
        const matchSearch = !search || item.department.toLowerCase().includes(search);
        const matchMinistry = !ministry || item.ministry.toLowerCase() === ministry;
        const matchDepartment = !department || item.department.toLowerCase() === department;
        const matchStatus = !status || item.status.toLowerCase() === status;
        const matchLocation = !location || item.location.toLowerCase() === location;
        const matchUsage = !usage || item.usage.toLowerCase() === usage;
        return matchSearch && matchMinistry && matchDepartment && matchStatus && matchLocation && matchUsage;
      });

      renderData(filtered);
    };

    const renderData = (data) => {
      const list = $("monitorList");
      const noData = $("noDataMsg");
      list.innerHTML = "";

      if (data.length === 0) {
        noData.classList.remove("hidden");
        return;
      }
      noData.classList.add("hidden");

      data.forEach(item => {
        list.innerHTML += `
          <div class="bg-white shadow rounded-xl p-4 border-l-4 ${item.usage === '‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà' ? 'border-green-500' : 'border-red-500'}">
            <h3 class="text-lg font-bold text-gray-800">${item.department}</h3>
            <p class="text-sm text-gray-600">‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á: ${item.ministry}</p>
            <p class="text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${item.status}</p>
            <p class="text-sm text-gray-600">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà: ${item.location}</p>
            <p class="text-sm text-gray-600">‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${item.usage}</p>
          </div>`;
      });
    };

    const resetFilters = () => {
      ["searchInput", "ministryFilter", "departmentFilter", "statusFilter", "locationFilter", "setupFilter"].forEach(id => $(id).value = "");
      renderData(allData);
    };

    const populateSelect = (id, options) => {
      const select = $(id);
      options.forEach(text => {
        const opt = document.createElement("option");
        opt.value = opt.textContent = text;
        select.appendChild(opt);
      });
    };

    $("searchBtn").onclick = filterData;
    $("clearBtn").onclick = resetFilters;
    $("searchInput").addEventListener("keypress", e => { if (e.key === "Enter") filterData(); });

    ["ministryFilter", "departmentFilter", "statusFilter", "locationFilter", "setupFilter"].forEach(id => {
      $(id).addEventListener("change", filterData);
    });

    fetch(sheetURL)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const rows = json.table.rows.slice(1); // skip header
        allData = rows.map(row => ({
          ministry: row.c[0]?.v || "", //‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á
          department: row.c[1]?.v || "", //‡∏Å‡∏£‡∏°
          status: row.c[2]?.v || "", //‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
          location: row.c[3]?.v || "", //‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà
          setup: row.c[6]?.v || "" //‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
        })).filter(row => row.department);

        const ministries = [...new Set(allData.map(item => item.ministry).filter(Boolean))];
        const departments = [...new Set(allData.map(item => item.department).filter(Boolean))];
        populateSelect("ministryFilter", ministries);
        populateSelect("departmentFilter", departments);

        renderData(allData);
      });
  </script>
</body>
</html>
